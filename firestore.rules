rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- Helper Functions ---

    // isAdmin() checks if the authenticated user's UID matches the admin UID.
    function isAdmin() {
      return request.auth != null && request.auth.uid == "jy39QM0BtDROwlkLPZvFFV4H8mk2";
    }

    // isOwner() checks if the authenticated user is the owner of a document.
    function isOwner(userId) {
      return request.auth != null && request.auth.uid == userId;
    }
    
    // --- Rules ---

    // Default deny all access to the database unless explicitly allowed.
    match /{document=**} {
      allow read, write: if false;
    }

    // Rules for user profile data.
    match /users/{userId} {
      // Any authenticated user can create their own user profile document.
      allow create: if isOwner(userId);
      // Users can read their own profile. The admin can read any user profile.
      allow read: if isOwner(userId) || isAdmin();
      // Users can only update their own profile. Admin can update any.
      allow update: if isOwner(userId) || isAdmin();
    }
    
    // Rules for school registration inquiries.
    match /schoolInquiries/{inquiryId} {
        // Anyone can create a new inquiry (submit the form).
        allow create: if true;
        // Only the admin can read, update, or delete inquiries.
        allow read, update, delete: if isAdmin();
    }
  }
}